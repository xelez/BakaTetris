
# Тетрис на двоих

Развитие всем известной игры с элементами мультиплеера, азарта и подлости.

## Идея

Два игрока параллельно играют в тетрис. Каждый видит и свою игру, и что происходит у второго игрока.
Задача - набрать больше очков, чем у противника. (???) При этом через каждый N'ый ход на поле делает другой игрок.
Тем самым он может либо заподлить, либо помочь. Это уже как пойдёт.

## Процесс с точки зрения игрока

 * Игрок открывает толстый(?) клиент на своём компьютере.
 * Он автоматически находит сервера и подключается к одному из них.
 * Игрок видит список открытых игр.
 * Он может либо подключится к уже существующей игре, либо создать новую.
 * Если он подключается к уже существующей игре, то сразу начинается собственно игра.
 * Если он создаёт новую, то начинается процесс ожидания второго игрока.
 * После окончания игры игроки возвращаются к списку игр.

## Техническая часть

Система включает в себя:

 * Толстый клиент на Qt.
 * Сервис поиска серверов через UPD Multicast.
 * Сервера "лобби"(нужно придумать более адекватное название) -- отвечает за регистрацию, авторизацию, списки игр.
 * Сервера игр (умеют обрабатывать логику игр и сообщать результат).
 * Сервера MongoDB для хранения данных о пользователях и результатов игр.
 * Сервера RabbitMQ для общения между игровыми серверами и серверами "лобби".

### Сервис поиска серверов

Сервер слушает на Multicast адресе `224.0.0.111` и `13334` порту (это настраивается). При получении любого запроса на свой адрес и порт в ответ
отправляет заранее заданный список адресов серверов.

В сети может быть запущено несколько серверов поиска на разных компьютерах. В таком случае, клиент получит списки серверов от их обоих (что нормально).
При отключении одного из серверов оставшийся продолжит работать.

### Толстый клиент

Клиент посылает запрос на Multicast адрес и получает в ответ от сервиса поиска список серверов "лобби". Выбирает из списка случайный и подключается к нему.
Если он не отвечает, пробует подключиться к другому случайному.

Общение с сервером "лобби" осуществляется через `REST`. Протокол описан далее.
Клиент регистрируется либо авторизуется на сервере "лобби" и получает токен для дальнейших операций на сервере.

После чего клиент через небольшие промежутки времени (случайное число миллисекунд, примерно 1--2 с.) заправшивает список открытый игр (т.е. игр,
к которым можно присоедениться) у сервера и отображает пользователю.

Пользователь может либо создать новую игру, либо присоедениться к существующей.

Как при присоединении к существующей, так и при создании новой игры пользователю предоставляется ip игрового сервера и токен, при помощи которого он может
подключится к этому серверу. Взаимодействие с этим сервером происходит при помощи технологии `socket.io`, работающей поверх websockets.

После подключения начинается ожидание второго игрока, и, когда он подключился и готов, сама игра.

После завершения игры пользователь возвращается обратно к списку игр.


